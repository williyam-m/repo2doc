{% extends 'base.html' %}
{% load static %}

{% block title %}Repo2Doc - Generate Documentation for Your Code{% endblock %}

{% block content %}
<div class="container">
    
    <div class="upload-form-container">
      <div class="upload-form">
        <form method="post" enctype="multipart/form-data" id="upload-form">
          {% csrf_token %}
          <div class="input-options-container">
            <div class="input-option">
              <div class="file-drop-area">
                <span class="drop-message">Drag and drop or upload your repo (zip)</span>
                <span class="choose-file">Choose file</span>
                <input type="file" name="code_file" id="file-input" class="file-input" accept=".zip">
                <div class="file-details" id="file-details"></div>
              </div>
            </div>
            
            <div class="input-option-divider">
              <span>OR</span>
            </div>
            
            <div class="input-option">
              <div class="github-url-container">
                <span class="github-url-label">Enter GitHub Repository URL</span>
                <input type="text" name="github_url" id="github-url" placeholder="https://github.com/username/repository" class="github-url-input">
              </div>
            </div>
          </div>
          
          {% if user.is_authenticated %}
          <div class="visibility-options">
            <label>
              <input type="radio" name="visibility" value="public" checked>
              <span class="visibility-label">Public</span>
              <span class="visibility-desc">Anyone can view</span>
            </label>
            
            <label>
              <input type="radio" name="visibility" value="private">
              <span class="visibility-label">Private</span>
              <span class="visibility-desc">Only you can view</span>
            </label>
            
            {% if user_organizations %}
            <label>
              <input type="radio" name="visibility" value="organization">
              <span class="visibility-label">Organization</span>
              <span class="visibility-desc">Share with your team</span>
            </label>
            
            <div class="org-select-wrapper" id="org-select-wrapper">
              <select name="organization_id" id="organization-select">
                {% for org in user_organizations %}
                <option value="{{ org.id }}">{{ org.name }}</option>
                {% endfor %}
              </select>
            </div>
            {% endif %}
          </div>
          {% endif %}
          
          <button class="submit-button" type="submit" id="generate-btn">Generate Documentation</button>
        </form>
      </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-content">
        <button class="close-btn" id="close-overlay-btn">Ã—</button>
        <div class="loading-bar-container">
          <div class="loading-bar" id="loading-bar"></div>
        </div>
        <div class="loading-percentage" id="loading-percentage">0%</div>
        <div class="loading-quote">"To build anything that truly lasts, it takes time"</div>
        <div class="loading-complete" id="loading-complete">
          <h3>Documentation Ready!</h3>
          <a href="#" class="view-link" id="view-doc-link">View Documentation</a>
        </div>
      </div>
    </div>

    {% if message %}
      <div class="success-message">{{ message }}</div>
    {% endif %}
    
    {% if error %}
      <div class="error-message">{{ error }}</div>
    {% endif %}

    <div class="navigation-boxes">
      <a href="{% url 'organization_list' %}" class="nav-box">
        <div class="nav-box-content">
          <h3 style="font-size: 1rem;">Organization</h3>
          <p>Create or join a team workspace</p>
        </div>
      </a>
      <a href="#" class="nav-box">
        <div class="nav-box-content">
          <h3 style="font-size: 1rem;">Developer Console</h3>
          <p>Coming soon</p>
        </div>
      </a>
    </div>
    
    <!-- Tabs for document types -->
    {% if user.is_authenticated %}
    <div class="doc-tabs">
      <button class="tab-btn active" data-tab="public">Public Repos</button>
      <button class="tab-btn" data-tab="my-repos">My Repos</button>
      <button class="tab-btn" data-tab="private">Private Repos</button>
      <button class="tab-btn" data-tab="organization">Organization Repos</button>
    </div>
    {% else %}
    <h2>Public Documentation</h2>
    {% endif %}
    
    <!-- Public Repos Tab (default) -->
    <div class="tab-content active" id="public-tab">
      <div class="docs-grid">
        {% for doc in doc_folders %}
          <a href="{% url 'view_doc' doc.id %}" class="doc-link">
            <div class="doc-card">
              <div class="doc-name">{{ doc.folder_name }}</div>
              <div class="doc-meta">
                <div class="doc-date">{{ doc.uploaded_at|date:"F j, Y" }}</div>
                <div class="doc-visibility">Public</div>
              </div>
            </div>
          </a>
        {% empty %}
          <p>No public documentation available.</p>
        {% endfor %}
      </div>
      {% if public_doc_count > doc_folders|length %}
        <div class="see-more-link">
          <a href="{% url 'public_repos_list' %}" class="white-button">See all {{ public_doc_count }} public repositories</a>
        </div>
      {% endif %}
    </div>
    
    <!-- My Repos Tab (only for authenticated users) -->
    {% if user.is_authenticated %}
    <div class="tab-content" id="my-repos-tab">
      <div class="docs-grid">
        {% for doc in my_doc_folders %}
          <a href="{% url 'view_doc' doc.id %}" class="doc-link">
            <div class="doc-card">
              <div class="doc-name">{{ doc.folder_name }}</div>
              <div class="doc-meta">
                <div class="doc-date">{{ doc.uploaded_at|date:"F j, Y" }}</div>
                <div class="doc-visibility">{{ doc.get_visibility_display }}</div>
                {% if doc.organization %}
                  <div class="doc-org">{{ doc.organization.name }}</div>
                {% endif %}
              </div>
            </div>
          </a>
        {% empty %}
          <p>You haven't created any documentation yet. Upload a repository to get started.</p>
        {% endfor %}
      </div>
      {% if my_doc_count > my_doc_folders|length %}
        <div class="see-more-link">
          <a href="{% url 'my_repos_list' %}" class="white-button">See all {{ my_doc_count }} repositories</a>
        </div>
      {% endif %}
    </div>
    
    <!-- Private Repos Tab -->
    <div class="tab-content" id="private-tab">
      <div class="docs-grid">
        {% for doc in private_doc_folders %}
          <a href="{% url 'view_doc' doc.id %}" class="doc-link">
            <div class="doc-card">
              <div class="doc-name">{{ doc.folder_name }}</div>
              <div class="doc-meta">
                <div class="doc-date">{{ doc.uploaded_at|date:"F j, Y" }}</div>
                <div class="doc-visibility">Private</div>
              </div>
            </div>
          </a>
        {% empty %}
          <p>You don't have any private repositories yet.</p>
        {% endfor %}
      </div>
      {% if private_doc_count > private_doc_folders|length %}
        <div class="see-more-link">
          <a href="{% url 'private_repos_list' %}" class="white-button">See all {{ private_doc_count }} private repositories</a>
        </div>
      {% endif %}
    </div>
    
    <!-- Organization Repos Tab -->
    <div class="tab-content" id="organization-tab">
      <div class="docs-grid">
        {% for doc in org_doc_folders %}
          <a href="{% url 'view_doc' doc.id %}" class="doc-link">
            <div class="doc-card">
              <div class="doc-name">{{ doc.folder_name }}</div>
              <div class="doc-meta">
                <div class="doc-date">{{ doc.uploaded_at|date:"F j, Y" }}</div>
                {% if doc.organization %}
                  <div class="doc-org">{{ doc.organization.name }}</div>
                {% endif %}
              </div>
            </div>
          </a>
        {% empty %}
          <p>No organization repositories available.</p>
        {% endfor %}
      </div>
      {% if org_doc_count > org_doc_folders|length %}
        <div class="see-more-link">
          <a href="{% url 'organization_repos_list' %}" class="white-button">See all {{ org_doc_count }} organization repositories</a>
        </div>
      {% endif %}
    </div>
    {% endif %}
  </div>

{% if latest_doc_id %}
  <input type="hidden" id="latest-doc-id" value="{{ latest_doc_id }}">
{% endif %}

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/index.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching functionality
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons and contents
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Add active class to current button
        button.classList.add('active');
        
        // Show corresponding content
        const tabId = button.getAttribute('data-tab');
        document.getElementById(tabId + '-tab').classList.add('active');
      });
    });
  });
</script>
{% endblock %}

<style>
  .see-more-link {
    text-align: center;
    margin-top: 20px;
  }
  
  .see-more-link a.white-button {
    display: inline-block;
    color: #000;
    background-color: #ffffff;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    transition: background-color 0.2s;
    font-weight: bold;
  }
  
  .see-more-link a.white-button:hover {
    background-color: #cccccc;
  }
</style>
