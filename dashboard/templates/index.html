{% extends 'base.html' %}
{% load static %}

{% block title %}Repo2Doc - Generate Documentation for Your Code{% endblock %}

{% block content %}
<div class="container">
    
    <div class="upload-form-container">
      <div class="upload-form">
        <form method="post" enctype="multipart/form-data" id="upload-form">
          {% csrf_token %}
          <div class="file-drop-area">
            <span class="drop-message">Drag and drop or upload your repo (zip)</span>
            <span class="choose-file">Choose file</span>
            <input type="file" name="code_file" id="file-input" class="file-input" accept=".zip" required>
            <div class="file-details" id="file-details"></div>
          </div>
          
          {% if user.is_authenticated %}
          <div class="visibility-options">
            <label>
              <input type="radio" name="visibility" value="public" checked>
              <span class="visibility-label">Public</span>
              <span class="visibility-desc">Anyone can view</span>
            </label>
            
            <label>
              <input type="radio" name="visibility" value="private">
              <span class="visibility-label">Private</span>
              <span class="visibility-desc">Only you can view</span>
            </label>
            
            {% if user_organizations %}
            <label>
              <input type="radio" name="visibility" value="organization">
              <span class="visibility-label">Organization</span>
              <span class="visibility-desc">Share with your team</span>
            </label>
            
            <div class="org-select-wrapper" id="org-select-wrapper">
              <select name="organization_id" id="organization-select">
                {% for org in user_organizations %}
                <option value="{{ org.id }}">{{ org.name }}</option>
                {% endfor %}
              </select>
            </div>
            {% endif %}
          </div>
          {% endif %}
          
          <button class="submit-button" type="submit" id="generate-btn">Generate Documentation</button>
        </form>
      </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-content">
        <button class="close-btn" id="close-overlay-btn">Ã—</button>
        <div class="loading-bar-container">
          <div class="loading-bar" id="loading-bar"></div>
        </div>
        <div class="loading-percentage" id="loading-percentage">0%</div>
        <div class="loading-quote">"To build anything that truly lasts, it takes time"</div>
        <div class="loading-complete" id="loading-complete">
          <h3>Documentation Ready!</h3>
          <a href="#" class="view-link" id="view-doc-link">View Documentation</a>
        </div>
      </div>
    </div>

    {% if message %}
      <div class="success-message">{{ message }}</div>
    {% endif %}
    
    {% if error %}
      <div class="error-message">{{ error }}</div>
    {% endif %}

    <div class="navigation-boxes">
      <a href="{% url 'organization_list' %}" class="nav-box">
        <div class="nav-box-content">
          <h3>Organization</h3>
          <p>Create or join a team workspace</p>
        </div>
      </a>
      <a href="#" class="nav-box">
        <div class="nav-box-content">
          <h3>Developer Console</h3>
          <p>Coming soon</p>
        </div>
      </a>
    </div>
    
    <!-- Tabs for document types -->
    {% if user.is_authenticated %}
    <div class="doc-tabs">
      <button class="tab-btn active" data-tab="public">Public Repos</button>
      <button class="tab-btn" data-tab="my-repos">My Repos</button>
    </div>
    {% else %}
    <h2>Public Documentation</h2>
    {% endif %}
    
    <!-- Public Repos Tab (default) -->
    <div class="tab-content active" id="public-tab">
      <div class="docs-grid">
        {% for doc in doc_folders %}
          <a href="{% url 'view_doc' doc.id %}" class="doc-link">
            <div class="doc-card">
              <div class="doc-name">{{ doc.folder_name }}</div>
              <div class="doc-meta">
                <div class="doc-date">{{ doc.uploaded_at|date:"F j, Y" }}</div>
                <div class="doc-visibility">Public</div>
              </div>
            </div>
          </a>
        {% empty %}
          <p>No public documentation available.</p>
        {% endfor %}
      </div>
    </div>
    
    <!-- My Repos Tab (only for authenticated users) -->
    {% if user.is_authenticated %}
    <div class="tab-content" id="my-repos-tab">
      <div class="docs-grid">
        {% for doc in my_doc_folders %}
          <a href="{% url 'view_doc' doc.id %}" class="doc-link">
            <div class="doc-card">
              <div class="doc-name">{{ doc.folder_name }}</div>
              <div class="doc-meta">
                <div class="doc-date">{{ doc.uploaded_at|date:"F j, Y" }}</div>
                <div class="doc-visibility">{{ doc.get_visibility_display }}</div>
                {% if doc.organization %}
                  <div class="doc-org">{{ doc.organization.name }}</div>
                {% endif %}
              </div>
            </div>
          </a>
        {% empty %}
          <p>You haven't created any documentation yet. Upload a repository to get started.</p>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

{% if latest_doc_id %}
  <input type="hidden" id="latest-doc-id" value="{{ latest_doc_id }}">
{% endif %}

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/index.js' %}"></script>
{% endblock %}
